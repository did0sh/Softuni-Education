<h1>Phonebook</h1>
<style ></style>
<ul id="phonebook"></ul>
<button id="btnLoad">Load</button>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<h2>Create Contact</h2>
Person: <input type="text" id="person" />
<br>
Phone: <input type="text" id="phone" />
<br>
<button id="btnCreate">Create</button>
<script>
    const URL = 'https://testapp-ec303.firebaseio.com/phonebook'
    const person = $('#person');
    const phone = $('#phone')

    $('#btnLoad').on('click', loadData)
    $('#btnCreate').on('click', postData)

    function loadData() {
        $('#phonebook').empty()
        $.ajax({
            method: 'GET',
            url: URL + '.json'
        }).then(handleSuccess)
            .catch(handleError)

        function handleSuccess(res) {
            for (let key in res) {
                generateLi(res[key].name, res[key].phone, key)
            }
        }
    }

    function postData() {
        let name = person.val()
        let phoneVal = phone.val()
        let postData = JSON.stringify({'name': name, 'phone':phoneVal})

        $.ajax({
            method: 'POST',
            url: URL + '.json',
            data: postData,
            success: appendElement,
            error: handleError
        })

        function appendElement(res) {
            generateLi(name, phoneVal, res.name)
        }

        person.val('')
        phone.val('')
    }

    function generateLi(name, phone, key) {
        let li = $(`<li>${name}: ${phone} </li>`)
            .append($('<a href="#">[Delete]</a>')
                .click(function () {
                    $.ajax({
                        method: 'DELETE',
                        url: URL + '/' + key + '.json'
                    }).then(() => $(li).remove())
                        .catch(handleError)
                }))
        $('#phonebook').append(li)
    }

    function handleError(err) {
        console.log(err)
    }
</script>